<div class="container">
  <div class="card mt-4 text-center">
    <div class="card-header bg-light border-0">
      <p class="mb-0"><strong>Memory</strong></p>
    </div>
    <div class="card-body">
      <canvas id="line-chart"></canvas>
    </div>
  </div>
</div>


<script type="module">
  import {Chart, initMDB} from "/assets/js/libs/chart.es.min.js";

  initMDB({Chart})

  const graphData = {{.GraphData}}

  const options = {
    animation: false,
    plugins: {
      legend: {
        position: 'bottom',
        labels: {
          boxWidth: 10,
        },
      },
    },
    scales: {
      y: {
        ticks: {
          beginAtZaero: true,
          callback: function (value, index, values) {
            return value + " " + "GiB";
          },
        }
      },
    },
  }


  console.log(graphData)
  const chart = document.getElementById('line-chart');
  const chartInstance = new Chart(chart, graphData, options);

  function refreshGraph(data) {
    console.log('refresh')
    console.log(data.data)
    chartInstance.update(data.data)
  }

  document.body.addEventListener('htmx:sseMessage', function (e) {
    if (e.detail.type !== "RefreshGraph") {
      return
    }

    refreshGraph(JSON.parse(e.detail.data))
  })

</script>
